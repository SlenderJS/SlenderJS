/**
 * SlenderJS - An open source JS Routing and Rendering library.
 * TwistPHP [ twistphp.com ]
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @version		1.1.1
 * @author		Dan Walker, James Durham
 * @license		https://www.gnu.org/licenses/gpl.html GPL License
 * @link		https://github.com/TwistPHP/SlenderJS
 */
!function(e,t,n,r){"function"==typeof define&&define.amd?define(r(t,n)):"object"==typeof exports?module.exports=r(t,n):e.SlenderJS=r(t,n)}(this,window,document,function(e,t){"use strict";return function(n){this.data={},this.conf={},this.conf.hooks=n.hooks||[],this.conf.render=n.render||[],this.conf.router=n.router||[],new function(e){e.arrayKeys=function(e){let t=[];for(let n in e)e.hasOwnProperty(n)&&t.push(n);return t},e.inArray=function(e,t){return t.length&&t.indexOf(e)>-1},e.isEmpty=function(e){return void 0===e||null==e||e.length<=0},e.preg_replace=function(e,t,n){return n.replace(e,t)},e.preg_match=function(e,t){return e.exec(t)},e.preg_match_all=function(e,t){let n=[],r=[...t.matchAll(e)];for(let e=0;e<r.length;e++){let t=[...r[e]];for(let e=0;e<t.length;e++)e in n||(n[e]=[]),n[e].push(t[e])}return n},e.parseUri=function(e){var n={},r=t.createElement("a");r.href=e;var o="protocol hostname host pathname port search hash href".split(" ");for(var i in o){var u=o[i];n[u]=r[u]}return n.toString=function(){return r.href},n.requestUri=n.pathname+n.search,n},e.csvToArray=function(e,t){t=t||",";const n=/(,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^,\r\n]*))/gi,r=[[]];let o;for(;o=n.exec(e);)o[1].length&&o[1]!==t&&r.push([]),r[r.length-1].push(void 0!==o[2]?o[2].replace(/""/g,'"'):o[3]);return r},e.md5=function(e){var t="0123456789abcdef";function n(e){var n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function o(e,t,n,o,i,u){return r((a=r(r(t,e),r(o,u)))<<(c=i)|a>>>32-c,n);var a,c}function i(e,t,n,r,i,u,a){return o(t&n|~t&r,e,t,i,u,a)}function u(e,t,n,r,i,u,a){return o(t&r|n&~r,e,t,i,u,a)}function a(e,t,n,r,i,u,a){return o(t^n^r,e,t,i,u,a)}function c(e,t,n,r,i,u,a){return o(n^(t|~r),e,t,i,u,a)}var s,l,f,p,d,h=function(e){var t,n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e),g=1732584193,m=-271733879,y=-1732584194,b=271733878;for(s=0;s<h.length;s+=16)l=g,f=m,p=y,d=b,g=i(g,m,y,b,h[s+0],7,-680876936),b=i(b,g,m,y,h[s+1],12,-389564586),y=i(y,b,g,m,h[s+2],17,606105819),m=i(m,y,b,g,h[s+3],22,-1044525330),g=i(g,m,y,b,h[s+4],7,-176418897),b=i(b,g,m,y,h[s+5],12,1200080426),y=i(y,b,g,m,h[s+6],17,-1473231341),m=i(m,y,b,g,h[s+7],22,-45705983),g=i(g,m,y,b,h[s+8],7,1770035416),b=i(b,g,m,y,h[s+9],12,-1958414417),y=i(y,b,g,m,h[s+10],17,-42063),m=i(m,y,b,g,h[s+11],22,-1990404162),g=i(g,m,y,b,h[s+12],7,1804603682),b=i(b,g,m,y,h[s+13],12,-40341101),y=i(y,b,g,m,h[s+14],17,-1502002290),m=i(m,y,b,g,h[s+15],22,1236535329),g=u(g,m,y,b,h[s+1],5,-165796510),b=u(b,g,m,y,h[s+6],9,-1069501632),y=u(y,b,g,m,h[s+11],14,643717713),m=u(m,y,b,g,h[s+0],20,-373897302),g=u(g,m,y,b,h[s+5],5,-701558691),b=u(b,g,m,y,h[s+10],9,38016083),y=u(y,b,g,m,h[s+15],14,-660478335),m=u(m,y,b,g,h[s+4],20,-405537848),g=u(g,m,y,b,h[s+9],5,568446438),b=u(b,g,m,y,h[s+14],9,-1019803690),y=u(y,b,g,m,h[s+3],14,-187363961),m=u(m,y,b,g,h[s+8],20,1163531501),g=u(g,m,y,b,h[s+13],5,-1444681467),b=u(b,g,m,y,h[s+2],9,-51403784),y=u(y,b,g,m,h[s+7],14,1735328473),m=u(m,y,b,g,h[s+12],20,-1926607734),g=a(g,m,y,b,h[s+5],4,-378558),b=a(b,g,m,y,h[s+8],11,-2022574463),y=a(y,b,g,m,h[s+11],16,1839030562),m=a(m,y,b,g,h[s+14],23,-35309556),g=a(g,m,y,b,h[s+1],4,-1530992060),b=a(b,g,m,y,h[s+4],11,1272893353),y=a(y,b,g,m,h[s+7],16,-155497632),m=a(m,y,b,g,h[s+10],23,-1094730640),g=a(g,m,y,b,h[s+13],4,681279174),b=a(b,g,m,y,h[s+0],11,-358537222),y=a(y,b,g,m,h[s+3],16,-722521979),m=a(m,y,b,g,h[s+6],23,76029189),g=a(g,m,y,b,h[s+9],4,-640364487),b=a(b,g,m,y,h[s+12],11,-421815835),y=a(y,b,g,m,h[s+15],16,530742520),m=a(m,y,b,g,h[s+2],23,-995338651),g=c(g,m,y,b,h[s+0],6,-198630844),b=c(b,g,m,y,h[s+7],10,1126891415),y=c(y,b,g,m,h[s+14],15,-1416354905),m=c(m,y,b,g,h[s+5],21,-57434055),g=c(g,m,y,b,h[s+12],6,1700485571),b=c(b,g,m,y,h[s+3],10,-1894986606),y=c(y,b,g,m,h[s+10],15,-1051523),m=c(m,y,b,g,h[s+1],21,-2054922799),g=c(g,m,y,b,h[s+8],6,1873313359),b=c(b,g,m,y,h[s+15],10,-30611744),y=c(y,b,g,m,h[s+6],15,-1560198380),m=c(m,y,b,g,h[s+13],21,1309151649),g=c(g,m,y,b,h[s+4],6,-145523070),b=c(b,g,m,y,h[s+11],10,-1120210379),y=c(y,b,g,m,h[s+2],15,718787259),m=c(m,y,b,g,h[s+9],21,-343485551),g=r(g,l),m=r(m,f),y=r(y,p),b=r(b,d);return n(g)+n(m)+n(y)+n(b)},e.date=function(e,t){let n,r;const o=["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur","January","February","March","April","May","June","July","August","September","October","November","December"],i=/\\?(.?)/gi,u=function(e,t){return r[e]?r[e]():t},a=function(e,t){for(e=String(e);e.length<t;)e="0"+e;return e};return r={d:function(){return a(r.j(),2)},D:function(){return r.l().slice(0,3)},j:function(){return n.getDate()},l:function(){return o[r.w()]+"day"},N:function(){return r.w()||7},S:function(){const e=r.j();let t=e%10;return["st","nd","rd"][(t=t<=3&&1===parseInt(e%100/10,10)?0:t)-1]||"th"},w:function(){return n.getDay()},z:function(){const e=new Date(r.Y(),r.n()-1,r.j()),t=new Date(r.Y(),0,1);return Math.round((e-t)/864e5)},W:function(){const e=new Date(r.Y(),r.n()-1,r.j()-r.N()+3),t=new Date(e.getFullYear(),0,4);return a(1+Math.round((e-t)/864e5/7),2)},F:function(){return o[6+r.n()]},m:function(){return a(r.n(),2)},M:function(){return r.F().slice(0,3)},n:function(){return n.getMonth()+1},t:function(){return new Date(r.Y(),r.n(),0).getDate()},L:function(){const e=r.Y();return e%4==0&e%100!=0|e%400==0},o:function(){const e=r.n(),t=r.W(),n=r.Y();return n+(12===e&&t<9?1:1===e&&t>9?-1:0)},Y:function(){return n.getFullYear()},y:function(){return r.Y().toString().slice(-2)},a:function(){return n.getHours()>11?"pm":"am"},A:function(){return r.a().toUpperCase()},B:function(){const e=3600*n.getUTCHours(),t=60*n.getUTCMinutes(),r=n.getUTCSeconds();return a(Math.floor((e+t+r+3600)/86.4)%1e3,3)},g:function(){return r.G()%12||12},G:function(){return n.getHours()},h:function(){return a(r.g(),2)},H:function(){return a(r.G(),2)},i:function(){return a(n.getMinutes(),2)},s:function(){return a(n.getSeconds(),2)},u:function(){return a(1e3*n.getMilliseconds(),6)},e:function(){throw new Error("Not supported (see source code of date() for timezone on how to add support)")},I:function(){const e=new Date(r.Y(),0),t=Date.UTC(r.Y(),0),n=new Date(r.Y(),6),o=Date.UTC(r.Y(),6);return e-t!=n-o?1:0},O:function(){const e=n.getTimezoneOffset(),t=Math.abs(e);return(e>0?"-":"+")+a(100*Math.floor(t/60)+t%60,4)},P:function(){const e=r.O();return e.substr(0,3)+":"+e.substr(3,2)},T:function(){return"UTC"},Z:function(){return 60*-n.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(i,u)},r:function(){return"D, d M Y H:i:s O".replace(i,u)},U:function(){return n/1e3|0}},function(e,t){return n=void 0===t?new Date:t instanceof Date?new Date(t):new Date(1e3*t),e.replace(i,u)}(e,t)}}(this),this.func={},this.func.data=this.data,this.app=t.querySelector("#app"),new function(e){function t(t){return t in e.conf.hooks.list?e.conf.hooks.list[t]:[]}function n(t,n){return t in e.conf.hooks.list&&n in e.conf.hooks.list[t]?e.conf.hooks.list[t][n]:null}function r(t,n){return t.call(e,...n)}e.func.hooks={all:t,get:n,register:function(t,n,r){t in e.conf.hooks.list||(e.conf.hooks.list[t]=[]),e.conf.hooks.list[t][n]=r},cancel:function(t,n){if(t in e.conf.hooks.list){let r=e.conf.hooks.list[t].indexOf(n);r>-1&&e.conf.hooks.list[t].splice(r,1)}},fire:function(e,o,i){if(i){let t=n(e,i);return t&&"function"==typeof t?r(t,o):t}{let n=t(e);for(let e in n)n.hasOwnProperty(e)&&r(n[e],o)}return!1}},e.conf.hooks={...{list:[]},...e.conf.hooks}}(this),new function(e){function t(t,r){let o='Error: Template "'+t+'" not found',i=e.conf.render.currentTemplate;return t.startsWith("./")&&(t=(e.conf.render.currentTemplate.split("/").slice(0,-1).join("/")+"/"+t.replace("./","")).replace("//","/")),t in e.conf.render.templates&&(e.conf.render.currentTemplate=t,o=n(e.conf.render.templates[t],r)),e.conf.render.currentTemplate=i,o}function n(t,n){if("function"==typeof t)return t.call(e,...[n]);let o=function(t){let n=e.preg_match_all(/{([^{}]+)}/gi,t);return n.length>1?n[1]:[]}(t);if(o.length>0)for(let e=0;e<o.length;e++)t=r(t,o[e],n);return t}function r(t,n,r){if(n.includes(":")){let i=e.preg_match(/^([^?]+)\?([\w\W]+\:[\w\W]+)$/,n);if(i&&i.length){let c=e.preg_match_all(/(\)|\()?([\w\d\:\-\_\.\'\"\[\]\/]+)([\=\!]{3}|[=\>\<\*\^\!\$]{2}|[\<\>\*]{1})([\w\d\s\:\-\_\.\'\"\/]+)(\)|\()?(&&|\|\|)?/gi,i[1]);if(c.length>1){let s=[],l=!1,f=!1,p=!0,d=0,h="",g="",m="",y="";for(let t=0;t<c[1].length;t++){let n=c[1][t];l=!l&&"("===n||l;let i=c[2][t].includes(":")?c[2][t].split(":"):null,u=c[4][t].includes(":")?c[4][t].split(":"):null,b="",w="";e.isEmpty(i)||(m="{"+c[2][t]+"}",b=c[2][t]),e.isEmpty(u)||(y="{"+c[4][t]+"}",w=c[4][t]);let k=e.isEmpty(i)?c[2][t]:o(m,b,i[0],i[1],r,!0),v=e.isEmpty(u)?c[4][t]:o(y,w,u[0],u[1],r,!0);v=v===y?"twst-undefined-variable":v;let _=a(k=k===m?"twst-undefined-variable":k,c[3][t],v);f=")"===c[5][t],(e.inArray(g,["&&",""])&&p||"||"===g&&!p||!1===l&&p)&&(p=_),(!1===l||l&&f)&&(!e.inArray(h,["&&",""])||d in s&&!0!==s[d]?"||"===h&&(s[++d]=p):s[d]=p,l=f=!1,p=!0,g=""),l?g=c[6][t]:h=c[6][t]}let b=!1;for(let e=0;e<s.length;e++)b=!!s[e]||b;if(s=e.preg_match_all(/(\'([^\']*)\'|\"([^\"]*)\"|([\d]+)|([\w\.\-\_\/\[]+:[\w\.\_\-\/\]]+)):?/gi,i[2]),e.isEmpty(s[5][b?0:1])){let r=b?0:1,o="";e.isEmpty(s[2][r])?e.isEmpty(s[3][r])?e.isEmpty(s[4][r])||(o=s[4][r]):o=s[3][r]:o=s[2][r],t=u(t,n,o)}else{let i=s[5][b?0:1].split(":"),a=e.md5(t);t=o(t,n,i[0],i[1],r),a===e.md5(t)&&(t=u(t,n,""))}}}else{let e=n.split(":"),i=e[0];e.splice(0,1);let u=e.join(":");t=o(t,n,i,u,r)}}return t}function o(n,r,a,s,l,f){f=f||!1;let p="",d=[],h="";if(e.conf.render.currentTag=r,a.includes("[")&&s.includes("]")){let e=a.split("[");p=e[0],a=e[1],s=s.replace(/\]$/gi,"")}else(d=e.preg_match(/(.*)\[(.*)\:(.*)\]/gi,r))&&(p=d[1],a=d[2],s=d[3]);let g=function(t,n){n=n||[];let r=[],i=e.csvToArray(t,",")[0];if(i.length){t=i[0],i.splice(0,1);for(let e=0;e<i.length;e++){let t=i[e];if(t.includes("=")){let e=t.split("="),i=e[0],u=e[1];if(u.includes(":")){let e=u.split(":");2===e.length&&(u=o("{"+u+"}",u,e[0],e[1],n))}u=c(u),r[i]=u.includes("|")?u.split("|"):u}else t.includes("|")?(t=c(t),r.push(t.includes("|")?t.split("|"):t)):(t=c(t),r[t]=!0)}}return[t,r]}(s,l);switch(s=g[0],"remove-tags"in(g=g[1])&&g["remove-tags"],"process-tags"in g&&g["process-tags"],a){case"data":let o=i(s,l,f);!0===o.status&&(n=u(n,r,o.return,p,o.return_raw,g));break;case"date":h=e.date(s),n=u(n,r,h,p,[],g);break;case"view":e.conf.render.viewParams=g,l="object"==typeof l?[l,...g]:g,s.startsWith("./")&&(s=(e.conf.render.currentTemplate.split("/").slice(0,-1).join("/")+"/"+s.replace("./","")).replace("//","/")),h=t(s,l),n=u(n,r,h,p,[],g);break;case"repeater":if(e.conf.render.viewParams=g,!e.isEmpty(g.view)&&s in l&&l[s].length){e.func.hooks.register("render_tags","parent",l);for(let e=0;e<l[s].length;e++)h+=t(g.view,l[s][e]);e.func.hooks.cancel("render_tags","parent")}n=u(n,r,h,p,[],g);break;default:let c=e.func.hooks.fire("render_tags",[s,l,g],a);if(!e.isEmpty(c)){if("object"==typeof c){let e=i(s,c,f);!0===e.status&&(c=e.return)}n=u(n,r,c,p,[],g)}}return n}function i(t,n,r){r=r||!1;let o={status:!1,return:"",return_raw:""};if("object"==typeof n)if(t.includes("/")){let i="";o.status=!e.isEmpty(i),o.return="object"==typeof n[t]&&!1===r?JSON.stringify(i,null,4):i,o.return_raw=i}else t in n&&(o.status=!0,o.return="object"==typeof n[t]&&!1===r?JSON.stringify(n[t],null,4):n[t],o.return_raw=n[t]);return o}function u(t,n,r,o,i,u){if(!e.isEmpty(o)){let t=["count","strlen","strtolower","strtoupper","date"];if(e.inArray(o,t))switch(o){case"count":case"strlen":r=i.length;break;case"strtolower":r=i.toLowerCase();break;case"strtoupper":r=i.toUpperCase();break;case"date":let t="Y-m-d H:i:s";"format"in u?t=u.format:0 in u?t=u[0]:1===u.length&&(t=e.arrayKeys(u).splice(0,1)),r=e.date(t,Date.parse(r))}else console.error("SlenderJS :: function '"+o+"' is not available")}return t.replace("{"+n+"}",r)}function a(t,n,r){let o=!1;switch(t=c(t),r=c(r),n){case"===":o=t===r;break;case"!==":o=t!==r;break;case"==":o=t==r||""==t&&"twst-undefined-variable"===r||""==r&&"twst-undefined-variable"===t;break;case"<":o=t<r;break;case">":o=t>r;break;case"<=":o=t<=r;break;case">=":o=t>=r;break;case"!=":o=t!=r;break;case"*":o=e.inArray(r,t);break;case"^=":o=t.substr(0,r.length)==r;break;case"*=":o=t.indexOf(r);break;case"=":o=t.substr(t.length-r.length,r.length)==r}return o}function c(t){if("boolean"!=typeof t&&"object"!=typeof t){let n=t.length;t="''"===t||'""'===t?"":t,t=e.preg_replace(/^([\'|\"]{1})([\W\w]+)([\'|\"]{1})/gi,"$2",t);let r=n===t.length;r&&"null"===t?t=null:r&&"undefined"===t?t="twst-undefined-variable":r&&"true"===t?t=!0:r&&"false"===t?t=!1:r&&e.preg_match(/^[0-9]+\.[0-9]+/gi,t)?t=parseFloat(t):r&&"number"==typeof t&&(t=parseInt(t))}return t}e.func.render={build:t,buildRaw:n,addTemplate:function(t,n){e.conf.render.templates[t]=n,e.func.hooks.fire("render_add_template",[t,n])}},e.conf.render={...{templates:[],viewParams:[],currentTag:null,currentTemplate:null},...e.conf.render}}(this),new function(n){function r(r){var i,u,a,c,s=n.conf.router.routes[404];r in n.conf.router.routes&&(s=n.conf.router.routes[r]),s.title=s.title||"",s.template=s.template||"",s.data=s.data||[],s.meta=s.meta||[],s.preventLoad=!1,n.func.hooks.fire("router_render_page",[r,s]),s.preventLoad||(i=r,u=s.title,a=function(e,t){return n.func.hooks.fire("router_page_body",[e,t]),n.func.render.build(t.template,t.data)}(r,s),c=s,n.func.hooks.fire("router_page_transition",[i,u,a,c],n.conf.router.transition),t.title=u,o(c),e.history.pushState({pageBody:a,pageTitle:u,pageInfo:c},u,i)),s.preventLoad=!1}function o(e){let r=t.querySelector("head title");return r.innerHTML=e.title,i(e.meta,!0),n.func.hooks.fire("router_page_head",[e]),""}function i(e,n){if(e=e||[],(n=n||!1)&&t.querySelectorAll("[data-smart-meta]").forEach(function(e,t){e.remove()}),e.length){let r=n?t.querySelector("head title").nextSibling:t.querySelector("head title");for(let o=0;o<e.length;o++){let i=t.createElement("meta");Object.keys(e[o]).forEach(t=>{i.setAttribute(t,e[o][t])}),n&&i.setAttribute("data-smart-meta",""),t.querySelector("head").insertBefore(i,r)}}}n.func.router={start:function(){n.func.hooks.register("router_page_transition","default",function(e,t,n,r){this.app.innerHTML=n}),i(n.conf.router.meta,!1),r(e.location.pathname)},page:r,addRoute:function(e,t){n.conf.router.routes[e]=t,n.func.hooks.fire("router_add_route",[e,t])}},n.conf.router.transition=n.conf.router.transition||"default",n.conf.router.meta=n.conf.router.meta||[],n.conf.router.domains=n.conf.router.domains||[],n.conf.router.routes=n.conf.router.routes||[],n.conf.router={transition:n.conf.router.transition,domains:n.conf.router.domains,meta:{...[{charset:"UTF-8"},{name:"viewport",content:"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"},{"http-equiv":"X-UA-Compatible",content:"ie=edge"}],...n.conf.router.meta},routes:{...{404:{title:"Page Not Found",template:"404.tpl"},403:{title:"Permission Denied",template:"403.tpl"}},...n.conf.router.routes}},e.onpopstate=function(e){e.state&&(t.title=e.state.pageTitle,t.body.innerHTML=e.state.pageBody,o(e.state.pageInfo))},e.addEventListener("click",function(e){let t=null;if(e.target.matches("a")?t=e.target.getAttribute("href"):e.target.matches("[data-smart-route]")&&(t=e.target.getAttribute("data-smart-route")),t){let o=n.parseUri(t);t&&(t.startsWith("/")||n.inArray(o.hostname,n.conf.router.domains))&&(e.preventDefault(),r(o.pathname))}})}(this),e.SlenderJS=this.func}});