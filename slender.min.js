/**
 * SlenderJS - An open source JS Routing and Rendering library.
 * TwistPHP [ twistphp.com ]
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 * @version		1.0.1
 * @author		Dan Walker, James Durham
 * @license		https://www.gnu.org/licenses/gpl.html GPL License
 * @link		https://github.com/TwistPHP/SlenderJS
 */
!function(e,t,n,r){"function"==typeof define&&define.amd?define(r(t,n)):"object"==typeof exports?module.exports=r(t,n):e.SlenderJS=r(t,n)}(this,window,document,function(e,t){"use strict";return function(n){this.data={},n.hooks=n.render||[],n.render=n.render||[],n.router=n.router||[],new function(e){e.inArray=function(e,t){return t.length&&t.indexOf(e)>-1},e.isEmpty=function(e){return void 0===e||null==e||e.length<=0},e.preg_replace=function(e,t,n){return n.replace(e,t)},e.preg_match=function(e,t){return e.exec(t)},e.preg_match_all=function(e,t){let n=[],r=[...t.matchAll(e)];for(let e=0;e<r.length;e++){let t=[...r[e]];for(let e=0;e<t.length;e++)e in n||(n[e]=[]),n[e].push(t[e])}return n},e.parseUri=function(e){var n={},r=t.createElement("a");r.href=e;var a="protocol hostname host pathname port search hash href".split(" ");for(var i in a){var o=a[i];n[o]=r[o]}return n.toString=function(){return r.href},n.requestUri=n.pathname+n.search,n},e.csvToArray=function(e,t){t=t||",";const n=/(,|\r?\n|\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^,\r\n]*))/gi,r=[[]];let a;for(;a=n.exec(e);)a[1].length&&a[1]!==t&&r.push([]),r[r.length-1].push(void 0!==a[2]?a[2].replace(/""/g,'"'):a[3]);return r},e.md5=function(e){var t="0123456789abcdef";function n(e){var n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}function a(e,t,n,a,i,o){return r((l=r(r(t,e),r(a,o)))<<(s=i)|l>>>32-s,n);var l,s}function i(e,t,n,r,i,o,l){return a(t&n|~t&r,e,t,i,o,l)}function o(e,t,n,r,i,o,l){return a(t&r|n&~r,e,t,i,o,l)}function l(e,t,n,r,i,o,l){return a(t^n^r,e,t,i,o,l)}function s(e,t,n,r,i,o,l){return a(n^(t|~r),e,t,i,o,l)}var u,c,f,p,h,d=function(e){var t,n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e),m=1732584193,g=-271733879,y=-1732584194,b=271733878;for(u=0;u<d.length;u+=16)c=m,f=g,p=y,h=b,m=i(m,g,y,b,d[u+0],7,-680876936),b=i(b,m,g,y,d[u+1],12,-389564586),y=i(y,b,m,g,d[u+2],17,606105819),g=i(g,y,b,m,d[u+3],22,-1044525330),m=i(m,g,y,b,d[u+4],7,-176418897),b=i(b,m,g,y,d[u+5],12,1200080426),y=i(y,b,m,g,d[u+6],17,-1473231341),g=i(g,y,b,m,d[u+7],22,-45705983),m=i(m,g,y,b,d[u+8],7,1770035416),b=i(b,m,g,y,d[u+9],12,-1958414417),y=i(y,b,m,g,d[u+10],17,-42063),g=i(g,y,b,m,d[u+11],22,-1990404162),m=i(m,g,y,b,d[u+12],7,1804603682),b=i(b,m,g,y,d[u+13],12,-40341101),y=i(y,b,m,g,d[u+14],17,-1502002290),g=i(g,y,b,m,d[u+15],22,1236535329),m=o(m,g,y,b,d[u+1],5,-165796510),b=o(b,m,g,y,d[u+6],9,-1069501632),y=o(y,b,m,g,d[u+11],14,643717713),g=o(g,y,b,m,d[u+0],20,-373897302),m=o(m,g,y,b,d[u+5],5,-701558691),b=o(b,m,g,y,d[u+10],9,38016083),y=o(y,b,m,g,d[u+15],14,-660478335),g=o(g,y,b,m,d[u+4],20,-405537848),m=o(m,g,y,b,d[u+9],5,568446438),b=o(b,m,g,y,d[u+14],9,-1019803690),y=o(y,b,m,g,d[u+3],14,-187363961),g=o(g,y,b,m,d[u+8],20,1163531501),m=o(m,g,y,b,d[u+13],5,-1444681467),b=o(b,m,g,y,d[u+2],9,-51403784),y=o(y,b,m,g,d[u+7],14,1735328473),g=o(g,y,b,m,d[u+12],20,-1926607734),m=l(m,g,y,b,d[u+5],4,-378558),b=l(b,m,g,y,d[u+8],11,-2022574463),y=l(y,b,m,g,d[u+11],16,1839030562),g=l(g,y,b,m,d[u+14],23,-35309556),m=l(m,g,y,b,d[u+1],4,-1530992060),b=l(b,m,g,y,d[u+4],11,1272893353),y=l(y,b,m,g,d[u+7],16,-155497632),g=l(g,y,b,m,d[u+10],23,-1094730640),m=l(m,g,y,b,d[u+13],4,681279174),b=l(b,m,g,y,d[u+0],11,-358537222),y=l(y,b,m,g,d[u+3],16,-722521979),g=l(g,y,b,m,d[u+6],23,76029189),m=l(m,g,y,b,d[u+9],4,-640364487),b=l(b,m,g,y,d[u+12],11,-421815835),y=l(y,b,m,g,d[u+15],16,530742520),g=l(g,y,b,m,d[u+2],23,-995338651),m=s(m,g,y,b,d[u+0],6,-198630844),b=s(b,m,g,y,d[u+7],10,1126891415),y=s(y,b,m,g,d[u+14],15,-1416354905),g=s(g,y,b,m,d[u+5],21,-57434055),m=s(m,g,y,b,d[u+12],6,1700485571),b=s(b,m,g,y,d[u+3],10,-1894986606),y=s(y,b,m,g,d[u+10],15,-1051523),g=s(g,y,b,m,d[u+1],21,-2054922799),m=s(m,g,y,b,d[u+8],6,1873313359),b=s(b,m,g,y,d[u+15],10,-30611744),y=s(y,b,m,g,d[u+6],15,-1560198380),g=s(g,y,b,m,d[u+13],21,1309151649),m=s(m,g,y,b,d[u+4],6,-145523070),b=s(b,m,g,y,d[u+11],10,-1120210379),y=s(y,b,m,g,d[u+2],15,718787259),g=s(g,y,b,m,d[u+9],21,-343485551),m=r(m,c),g=r(g,f),y=r(y,p),b=r(b,h);return n(m)+n(g)+n(y)+n(b)}}(this),this.func={},this.func.data=this.data,this.app=t.querySelector("#app"),new function(e,t){function n(t){return t in e.hooks?e.hooks[t]:[]}function r(t,n){return t in e.hooks&&n in e.hooks[t]?e.hooks[t][n]:null}function a(e,n){return e.call(t,...n)}t.func.hooks={all:n,get:r,register:function(t,n,r){t in e.hooks||(e.hooks[t]=[]),e.hooks[t][n]=r},cancel:function(t,n){if(t in e.hooks){let r=e.hooks[t].indexOf(n);r>-1&&e.hooks[t].splice(r,1)}},fire:function(e,t,i){if(i){let n=r(e,i);return n&&"function"==typeof n?a(n,t):n}{let r=n(e);for(let e in r)r.hasOwnProperty(e)&&a(r[e],t)}return!1}},e={...{hooks:[]},...e}}(n.hooks,this),new function(e,t){function n(t,n){let a='Error: Template "'+t+'" not found';return t in e.templates&&(e.currentTemplate=t,a=r(e.templates[t],n)),a}function r(e,n){let r=function(e){let n=t.preg_match_all(/{([^{}]+)}/gi,e);return n.length>1?n[1]:[]}(e);if(r.length>0)for(let t=0;t<r.length;t++)e=a(e,r[t],n);return e}function a(e,n,r){if(n.includes(":")){let a=t.preg_match(/^([^?]+)\?([\w\W]+\:[\w\W]+)$/,n);if(a&&a.length){let o=t.preg_match_all(/(\)|\()?([\w\d\:\-\_\.\'\"\[\]\/]+)([\=\!]{3}|[=\>\<\*\^\!\$]{2}|[\<\>\*]{1})([\w\d\s\:\-\_\.\'\"\/]+)(\)|\()?(&&|\|\|)?/gi,a[1]);if(o.length>1){let u=[],c=!1,f=!1,p=!0,h=0,d="",m="",g="",y="";for(let e=0;e<o[1].length;e++){let n=o[1][e];c=!c&&"("===n||c;let a=o[2][e].includes(":")?o[2][e].split(":"):null,l=o[4][e].includes(":")?o[4][e].split(":"):null,b="",k="";t.isEmpty(a)||(g="{"+o[2][e]+"}",b=o[2][e]),t.isEmpty(l)||(y="{"+o[4][e]+"}",k=o[4][e]);let _=t.isEmpty(a)?o[2][e]:i(g,b,a[0],a[1],r,!0),v=t.isEmpty(l)?o[4][e]:i(y,k,l[0],l[1],r,!0);v=v===y?"twst-undefined-variable":v;let w=s(_=_===g?"twst-undefined-variable":_,o[3][e],v);f=")"===o[5][e],(t.inArray(m,["&&",""])&&p||"||"===m&&!p||!1===c&&p)&&(p=w),(!1===c||c&&f)&&(!t.inArray(d,["&&",""])||h in u&&!0!==u[h]?"||"===d&&(u[++h]=p):u[h]=p,c=f=!1,p=!0,m=""),c?m=o[6][e]:d=o[6][e]}let b=!1;for(let e=0;e<u.length;e++)b=!!u[e]||b;if(""!==(u=t.preg_match_all(/(\'([^\']*)\'|\"([^\"]*)\"|([\d]+)|([\w\.\-\_\/\[]+:[\w\.\_\-\/\]]+)):?/gi,a[2]))[5][b?0:1]){let a=u[5][b?0:1].split(":"),o=t.md5(e);e=i(e,n,a[0],a[1],r),o===t.md5(e)&&(e=l(e,n,""))}else{let r=b?0:1,a="";t.isEmpty(u[2][r])?t.isEmpty(u[3][r])?t.isEmpty(u[4][r])||(a=u[4][r]):a=u[3][r]:a=u[2][r],e=l(e,n,a)}}}else{let t=n.split(":"),a=t[0];t.splice(0,1);let o=t.join(":");e=i(e,n,a,o,r)}}return e}function i(r,a,s,c,f,p){p=p||!1;let h="",d=[],m="";if(e.currentTag=a,s.includes("[")&&c.includes("]")){let e=s.split("[");h=e[0],s=e[1],c=c.replace(/\]$/gi,"")}else(d=t.preg_match(/(.*)\[(.*)\:(.*)\]/gi,a))&&(h=d[1],s=d[2],c=d[3]);let g=function(e,n){n=n||[];let r=[],a=t.csvToArray(e,",")[0];if(a.length){e=a[0],a.splice(0,1);for(let e=0;e<a.length;e++){let t=a[e];if(t.includes("=")){let e=t.split("="),a=e[0],o=e[1];if(o.includes(":")){let e=o.split(":");2===e.length&&(o=i("{"+o+"}",o,e[0],e[1],n))}o=u(o),r[a]=o.includes("|")?o.split("|"):o}else t.includes("|")?(t=u(t),r.push(t.includes("|")?t.split("|"):t)):(t=u(t),r[t]=!0)}}return[e,r]}(c,f);switch(c=g[0],"remove-tags"in(g=g[1])&&g["remove-tags"],"process-tags"in g&&g["process-tags"],s){case"data":let i=o(c,f,p);!0===i.status&&(r=l(r,a,i.return,h,i.return_raw,g));break;case"view":e.viewParams=g,f="object"==typeof f?[f,...g]:g,c.startsWith("./")&&(c=e.currentTemplate.split("/").slice(0,-1).join("/")+"/"+c.replace("./","")),m=n(c,f),r=l(r,a,m,h,[],g);break;case"repeater":if(e.viewParams=g,!t.isEmpty(g.view)&&c in f&&f[c].length){t.func.hooks.register("render_tags","parent",f);for(let e=0;e<f[c].length;e++)m+=n(g.view,f[c][e]);t.func.hooks.cancel("render_tags","parent")}r=l(r,a,m,h,[],g);break;default:let u=t.func.hooks.fire("render_tags",[c,f,g],s);t.isEmpty(u)||("object"==typeof u&&(u=o(c,mxdExtensions,p)),r=l(r,a,u,h,[],g))}return r}function o(e,n,r){r=r||!1;let a={status:!1,return:"",return_raw:""};if("object"==typeof n)if(e.includes("/")){let i="";a.status=!t.isEmpty($mxdTempData),a.return="object"==typeof n[e]&&!1===r?JSON.stringify(i,null,4):i,a.return_raw=i}else e in n&&(a.status=!0,a.return="object"==typeof n[e]&&!1===r?JSON.stringify(n[e],null,4):n[e],a.return_raw=n[e]);return a}function l(e,t,n,r,a,i){return e.replace("{"+t+"}",n)}function s(e,n,r){let a=!1;switch(e=u(e),r=u(r),n){case"===":a=e===r;break;case"!==":a=e!==r;break;case"==":a=e==r||""==e&&"twst-undefined-variable"===r||""==r&&"twst-undefined-variable"===e;break;case"<":a=e<r;break;case">":a=e>r;break;case"<=":a=e<=r;break;case">=":a=e>=r;break;case"!=":a=e!=r;break;case"*":a=t.inArray(r,e);break;case"^=":a=e.substr(0,r.length)==r;break;case"*=":a=e.indexOf(r);break;case"=":a=e.substr(e.length-r.length,r.length)==r}return a}function u(e){if("boolean"!=typeof e&&"object"!=typeof e){let n=e.length;e="''"===e||'""'===e?"":e,e=t.preg_replace(/^([\'|\"]{1})([\W\w]+)([\'|\"]{1})/gi,"$2",e);let r=n===e.length;r&&"null"===e?e=null:r&&"undefined"===e?e="twst-undefined-variable":r&&"true"===e?e=!0:r&&"false"===e?e=!1:r&&t.preg_match(/^[0-9]+\.[0-9]+/gi,e)?e=parseFloat(e):r&&"number"==typeof e&&(e=parseInt(e))}return e}t.func.render={build:n,buildRaw:r,addTemplate:function(n,r){e.templates[n]=r,t.func.hooks.fire("render_add_template",[n,r])}},e={...{templates:[],viewParams:[],currentTag:null,currentTemplate:null},...e}}(n.render,this),new function(n,r){function a(a){var o,l,s,u,c=n.routes[404];a in n.routes&&(c=n.routes[a]),c.title=c.title||"",c.template=c.template||"",c.data=c.data||[],c.meta=c.meta||[],c.preventLoad=!1,r.func.hooks.fire("router_render_page",[a,c]),c.preventLoad||(o=a,l=c.title,s=function(e,t){return r.func.hooks.fire("router_page_body",[e,t]),r.func.render.build(t.template,t.data)}(a,c),u=c,r.func.hooks.fire("router_page_transition",[o,l,s,u],n.transition),t.title=l,i(u),e.history.pushState({pageBody:s,pageTitle:l,pageInfo:u},l,o)),c.preventLoad=!1}function i(e){let n=t.querySelector("head title");return n.innerHTML=e.title,o(e.meta,!0),r.func.hooks.fire("router_page_head",[e]),""}function o(e,n){if(e=e||[],(n=n||!1)&&t.querySelectorAll("[data-smart-meta]").forEach(function(e,t){e.remove()}),e.length){let r=n?t.querySelector("head title").nextSibling:t.querySelector("head title");for(let a=0;a<e.length;a++){let i=t.createElement("meta");Object.keys(e[a]).forEach(t=>{i.setAttribute(t,e[a][t])}),n&&i.setAttribute("data-smart-meta",""),t.querySelector("head").insertBefore(i,r)}}}r.func.router={start:function(){r.func.hooks.register("router_page_transition","default",function(e,t,n,r){this.app.innerHTML=n}),o(n.meta,!1),a(e.location.pathname)},page:a,addRoute:function(e,t){n.routes[e]=t,r.func.hooks.fire("router_add_route",[e,t])}},n.transition=n.transition||"default",n.meta=n.meta||[],n.domains=n.domains||[],n.routes=n.routes||[],n={transition:n.transition,domains:n.domains,meta:{...[{charset:"UTF-8"},{name:"viewport",content:"width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"},{"http-equiv":"X-UA-Compatible",content:"ie=edge"}],...n.meta},routes:{...{404:{title:"Page Not Found",template:"404.tpl"},403:{title:"Permission Denied",template:"403.tpl"}},...n.routes}},e.onpopstate=function(e){e.state&&(t.title=e.state.pageTitle,t.body.innerHTML=e.state.pageBody,i(e.state.pageInfo))},e.addEventListener("click",function(e){let t=null;if(e.target.matches("a")?t=e.target.getAttribute("href"):e.target.matches("[data-smart-route]")&&(t=e.target.getAttribute("data-smart-route")),t){let i=r.parseUri(t);t&&(t.startsWith("/")||r.inArray(i.hostname,n.domains))&&(e.preventDefault(),a(i.pathname))}})}(n.router,this),e.SlenderJS=this.func}});